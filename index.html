<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Schedule Diagnostic | UW-Parkside</title>
    <style>
        :root {
            --uwp-primary: #005596;
            --uwp-secondary: #C5C9D2;
            --uwp-accent: #00703C;
            --uwp-dark: #002F5F;
            --uwp-light: #F2F2F2;
            --uwp-text: #333333;
            --uwp-text-light: #666666;
            --uwp-border: #D0D0D0;
            --uwp-hover: #003B73;
            --uwp-warning: #D44500;
            --uwp-success: #00703C;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: var(--uwp-light);
            color: var(--uwp-text);
            line-height: 1.3;
            font-size: 13px;
            padding: 5px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        
        .uwp-header {
            background: linear-gradient(to right, var(--uwp-primary), var(--uwp-dark));
            color: white;
            padding: 10px 15px;
            border-bottom: 3px solid var(--uwp-accent);
        }
        
        .uwp-header h1 {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }
        
        .uwp-header p {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 3px;
        }
        
        .progress-container {
            padding: 8px 15px;
            background: #f8f9fa;
            border-bottom: 1px solid var(--uwp-border);
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--uwp-light);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--uwp-accent);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            font-size: 11px;
            color: var(--uwp-text-light);
            text-align: right;
            margin-top: 2px;
        }
        
        /* Previous diagnostic styles remain the same until results section */
        
        /* ENHANCED RESULTS PAGE */
        .results-container {
            padding: 15px;
        }
        
        .results-header {
            border-bottom: 2px solid var(--uwp-primary);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .results-header h2 {
            color: var(--uwp-primary);
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .results-header p {
            color: var(--uwp-text-light);
            font-size: 13px;
        }
        
        /* Personalized Insight Dashboard */
        .insight-dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .primary-insight {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid var(--uwp-border);
            border-radius: 4px;
            padding: 15px;
            border-left: 4px solid var(--uwp-primary);
        }
        
        .primary-insight h3 {
            color: var(--uwp-primary);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .insight-emphasis {
            background: #FFF3CD;
            border-left: 4px solid #FFC107;
            padding: 10px;
            margin: 10px 0;
            font-style: italic;
            font-weight: 500;
        }
        
        .quick-summary {
            background: white;
            border: 1px solid var(--uwp-border);
            border-radius: 4px;
            padding: 15px;
        }
        
        .quick-summary h4 {
            color: var(--uwp-primary);
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        /* Enhanced Score Analysis */
        .score-analysis {
            margin: 20px 0;
        }
        
        .analysis-section {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid var(--uwp-border);
            border-radius: 4px;
            background: white;
        }
        
        .section-header-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .section-title {
            font-weight: 600;
            color: var(--uwp-primary);
            font-size: 14px;
        }
        
        .score-display {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-value {
            font-weight: 700;
            font-size: 16px;
            color: var(--uwp-dark);
        }
        
        .score-bar-container {
            width: 100px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .score-bar {
            height: 100%;
            border-radius: 4px;
        }
        
        .score-low { background: var(--uwp-success); }
        .score-medium { background: #FFC107; }
        .score-high { background: var(--uwp-warning); }
        
        .score-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .score-low-label { color: var(--uwp-success); }
        .score-medium-label { color: #FFC107; }
        .score-high-label { color: var(--uwp-warning); }
        
        .personalized-insight {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
            font-size: 12.5px;
        }
        
        .insight-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 5px;
            text-align: center;
            line-height: 16px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .insight-strength { background: var(--uwp-success); color: white; }
        .insight-challenge { background: var(--uwp-warning); color: white; }
        .insight-neutral { background: var(--uwp-secondary); color: var(--uwp-text); }
        
        /* Personalized Action Plan */
        .action-plan {
            margin: 20px 0;
            background: white;
            border: 1px solid var(--uwp-border);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .action-plan-header {
            background: linear-gradient(to right, var(--uwp-primary), var(--uwp-dark));
            color: white;
            padding: 12px 15px;
            font-weight: 600;
        }
        
        .action-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .action-item:last-child {
            border-bottom: none;
        }
        
        .action-number {
            background: var(--uwp-primary);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .action-content h4 {
            color: var(--uwp-primary);
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        .action-content p {
            font-size: 12.5px;
            color: var(--uwp-text);
        }
        
        /* Lab-Centered Design */
        .lab-design {
            margin: 20px 0;
            background: white;
            border: 1px solid var(--uwp-border);
            border-radius: 4px;
            padding: 15px;
        }
        
        .lab-design h3 {
            color: var(--uwp-primary);
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .lab-anchor {
            background: var(--uwp-accent);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .lab-phase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .phase-card {
            border: 1px solid var(--uwp-border);
            border-radius: 4px;
            padding: 12px;
            background: #f8f9fa;
        }
        
        .phase-card h4 {
            color: var(--uwp-primary);
            margin-bottom: 8px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .phase-time {
            font-size: 11px;
            color: var(--uwp-text-light);
            background: white;
            padding: 2px 6px;
            border-radius: 2px;
            display: inline-block;
            margin-bottom: 8px;
        }
        
        /* Comparison Visualization */
        .comparison-viz {
            margin: 20px 0;
            background: white;
            border: 1px solid var(--uwp-border);
            border-radius: 4px;
            padding: 15px;
        }
        
        .viz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .viz-header h3 {
            color: var(--uwp-primary);
            font-size: 16px;
        }
        
        .viz-container {
            display: flex;
            height: 120px;
            gap: 10px;
            align-items: flex-end;
        }
        
        .viz-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .viz-bar {
            width: 80%;
            border-radius: 3px 3px 0 0;
            transition: height 0.5s ease;
        }
        
        .viz-label {
            margin-top: 5px;
            font-size: 11px;
            text-align: center;
            font-weight: 600;
        }
        
        .viz-value {
            font-size: 10px;
            color: var(--uwp-text-light);
            margin-top: 2px;
        }
        
        /* Download Section */
        .download-section {
            text-align: center;
            margin: 25px 0 15px 0;
            padding: 20px;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-radius: 4px;
            border: 1px solid var(--uwp-border);
        }
        
        .download-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: var(--uwp-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 2px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn:hover {
            background: var(--uwp-hover);
        }
        
        .btn-success {
            background: var(--uwp-accent);
        }
        
        .btn-success:hover {
            background: #005a2d;
        }
        
        .btn-warning {
            background: var(--uwp-warning);
        }
        
        .btn-warning:hover {
            background: #b33a00;
        }
        
        /* Hidden sections */
        .hidden {
            display: none !important;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .insight-dashboard {
                grid-template-columns: 1fr;
            }
            
            .lab-phase {
                grid-template-columns: 1fr;
            }
            
            .download-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- UWP Header -->
        <div class="uwp-header">
            <h1>Lab Schedule Diagnostic</h1>
            <p>University of Wisconsin-Parkside ‚Ä¢ Personal Scheduling Analysis</p>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">Section <span id="currentSection">A</span> of 5 ‚Ä¢ <span id="questionsComplete">0</span>/25 questions answered</div>
        </div>
        
        <!-- Main Diagnostic Container (Previous implementation) -->
        <div class="diagnostic-container">
            <!-- Previous diagnostic interface remains exactly the same -->
            <!-- ... (omitted for brevity, same as before) ... -->
        </div>
        
        <!-- ENHANCED RESULTS PAGE -->
        <div class="hidden" id="enhancedResultsPage">
            <div class="results-container">
                <div class="results-header">
                    <h2>üìä Your Personal Schedule Analysis</h2>
                    <p>Based on your diagnostic responses, here's what your scores reveal about your scheduling system</p>
                </div>
                
                <!-- Personalized Insight Dashboard -->
                <div class="insight-dashboard">
                    <div class="primary-insight">
                        <h3>üéØ Your Primary Scheduling Challenge</h3>
                        <div id="primaryChallengeText">
                            <p>Your diagnostic shows that <strong id="challengeArea">[Challenge Area]</strong> is your biggest scheduling obstacle. This isn't a personal flaw‚Äîit's a <em>system mismatch</em>.</p>
                        </div>
                        <div class="insight-emphasis" id="personalizedAha">
                            "Your current system is failing because it doesn't account for [your specific constraint]. Here's how to fix it..."
                        </div>
                        <p id="systemMismatchDetail">The standard advice you've been given assumes [wrong assumption], but your reality requires [your actual need].</p>
                    </div>
                    
                    <div class="quick-summary">
                        <h4>üìà Your Profile Summary</h4>
                        <div class="summary-item">
                            <span>Situation Type:</span>
                            <strong id="situationType">Analyzing...</strong>
                        </div>
                        <div class="summary-item">
                            <span>Total Score:</span>
                            <strong id="totalScoreDisplay">0/72</strong>
                        </div>
                        <div class="summary-item">
                            <span>Biggest Strength:</span>
                            <strong id="biggestStrength">Identifying...</strong>
                        </div>
                        <div class="summary-item">
                            <span>Critical Area:</span>
                            <strong id="criticalArea">Analyzing...</strong>
                        </div>
                        <div class="summary-item">
                            <span>Lab Impact:</span>
                            <strong id="labImpact">Calculating...</strong>
                        </div>
                    </div>
                </div>
                
                <!-- Detailed Score Analysis -->
                <div class="score-analysis">
                    <h3 style="color: var(--uwp-primary); margin-bottom: 15px; font-size: 16px;">üìã Section-by-Section Analysis</h3>
                    
                    <div id="scoreAnalysisContainer">
                        <!-- Will be populated by JavaScript -->
                        <p>Complete the diagnostic to see your personalized score analysis...</p>
                    </div>
                </div>
                
                <!-- Personalized Action Plan -->
                <div class="action-plan">
                    <div class="action-plan-header">üöÄ Your Personalized Action Plan</div>
                    <div id="actionPlanItems">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Lab-Centered Design -->
                <div class="lab-design">
                    <h3>üß™ Lab-Centered Week Design <span class="lab-anchor">Tuesday 2:00-4:50</span></h3>
                    <p>Based on your scores, here's how to structure your week around your lab:</p>
                    
                    <div class="lab-phase">
                        <div class="phase-card" id="preLabDesign">
                            <h4>üìÖ Pre-Lab Preparation</h4>
                            <div class="phase-time" id="preLabTime">Loading...</div>
                            <p id="preLabStrategy">Your pre-lab strategy will be customized based on your planning scores.</p>
                        </div>
                        
                        <div class="phase-card" id="inLabDesign">
                            <h4>üî¨ In-Lab Approach</h4>
                            <div class="phase-time">Tuesday 2:00-4:50</div>
                            <p id="inLabStrategy">Your in-lab focus will be adjusted based on your attention scores.</p>
                        </div>
                        
                        <div class="phase-card" id="postLabDesign">
                            <h4>üìù Post-Lab Processing</h4>
                            <div class="phase-time" id="postLabTime">Loading...</div>
                            <p id="postLabStrategy">Your post-lab strategy will be optimized based on your time volatility.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Score Comparison Visualization -->
                <div class="comparison-viz">
                    <div class="viz-header">
                        <h3>‚öñÔ∏è Your Score Profile vs Typical Student</h3>
                        <div style="font-size: 11px; color: var(--uwp-text-light);">Higher bars = bigger challenges</div>
                    </div>
                    <div class="viz-container" id="comparisonViz">
                        <!-- Visualization will be generated by JavaScript -->
                    </div>
                </div>
                
                <!-- Download Section -->
                <div class="download-section">
                    <h3 style="color: var(--uwp-primary); margin-bottom: 10px;">üì• Save Your Personal Analysis</h3>
                    <p style="color: var(--uwp-text-light); font-size: 12px; margin-bottom: 15px;">Download your personalized plan for reference or share with an academic advisor</p>
                    
                    <div class="download-buttons">
                        <button class="btn-success" id="downloadPersonalPlan">
                            üìÑ Download Personal Plan (PDF)
                        </button>
                        <button class="btn" id="scheduleAdvisorMeeting">
                            üë• Schedule Advisor Meeting
                        </button>
                        <button class="btn-warning" id="retakeDiagnosticBtn">
                            üîÑ Retake Diagnostic
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- UWP Footer -->
        <div class="uwp-footer">
            University of Wisconsin-Parkside ‚Ä¢ Student Success Initiative
            <br>
            <span style="font-size:10px;">¬© 2024 UW-Parkside. Personalized scheduling analysis powered by constraint-based assessment.</span>
        </div>
    </div>

    <script>
        // ENHANCED PERSONALIZATION LOGIC ENGINE
        
        // Previous diagnostic code remains the same up to the showResults function
        
        // Enhanced showResults function
        function showEnhancedResults() {
            document.querySelector('.diagnostic-container').classList.add('hidden');
            document.querySelector('.button-container').classList.add('hidden');
            document.getElementById('enhancedResultsPage').classList.remove('hidden');
            
            // Calculate all insights
            calculatePersonalizedInsights();
            generateScoreAnalysis();
            generateActionPlan();
            generateLabDesign();
            generateVisualization();
        }
        
        // Personalization Logic Engine
        function calculatePersonalizedInsights() {
            const totalScore = Object.values(scores).reduce((a, b) => a + b, 0);
            
            // Determine which sections are strengths (low scores) and challenges (high scores)
            const sectionLabels = {
                A: 'Time Volatility',
                B: 'Planning & Estimation',
                C: 'Study Strategies',
                D: 'Attention & Focus',
                E: 'Access & Constraints'
            };
            
            // Calculate percentage of max for each section
            const sectionPercentages = {};
            for (const section in scores) {
                sectionPercentages[section] = (scores[section] / sectionMaxScores[section]) * 100;
            }
            
            // Find highest and lowest scores
            let highestSection = '';
            let highestPercentage = 0;
            let lowestSection = '';
            let lowestPercentage = 100;
            
            for (const section in sectionPercentages) {
                if (sectionPercentages[section] > highestPercentage) {
                    highestPercentage = sectionPercentages[section];
                    highestSection = section;
                }
                if (sectionPercentages[section] < lowestPercentage) {
                    lowestPercentage = sectionPercentages[section];
                    lowestSection = section;
                }
            }
            
            // Determine situation type
            const situationType = determineSituationType(totalScore, sectionPercentages);
            
            // Generate personalized text
            document.getElementById('situationType').textContent = situationType.name;
            document.getElementById('totalScoreDisplay').textContent = `${totalScore}/72`;
            
            // Primary Challenge
            const challengeText = generateChallengeText(highestSection, highestPercentage, situationType);
            document.getElementById('challengeArea').textContent = sectionLabels[highestSection];
            document.getElementById('primaryChallengeText').innerHTML = challengeText;
            
            // "Aha!" Moment
            const ahaMoment = generateAhaMoment(highestSection, lowestSection, situationType);
            document.getElementById('personalizedAha').innerHTML = ahaMoment;
            
            // System Mismatch Detail
            const mismatchDetail = generateMismatchDetail(highestSection, sectionPercentages);
            document.getElementById('systemMismatchDetail').textContent = mismatchDetail;
            
            // Quick Summary
            document.getElementById('biggestStrength').textContent = 
                sectionLabels[lowestSection] + " (" + Math.round(lowestPercentage) + "%)";
            document.getElementById('criticalArea').textContent = 
                sectionLabels[highestSection] + " (" + Math.round(highestPercentage) + "%)";
            document.getElementById('labImpact').textContent = 
                calculateLabImpact(sectionPercentages);
            
            // Store for other functions
            window.userProfile = {
                scores: scores,
                percentages: sectionPercentages,
                highestSection: highestSection,
                lowestSection: lowestSection,
                situationType: situationType,
                totalScore: totalScore
            };
        }
        
        function determineSituationType(totalScore, percentages) {
            // More sophisticated determination based on score patterns
            const types = {
                1: { name: "Volatile Week Student", description: "Your schedule changes too much for fixed plans" },
                2: { name: "Overcommitted Achiever", description: "Trying to do everything leads to mid-week collapse" },
                3: { name: "Last-Minute Survivor", description: "Relies on adrenaline rather than systems" },
                4: { name: "Strategy-Deficient Student", description: "Willing to study but unsure how" },
                5: { name: "Burned-Out / Low Bandwidth", description: "Energy, not time, is your bottleneck" },
                6: { name: "Structurally Constrained", description: "External constraints dominate your schedule" },
                7: { name: "Miscalibrated Optimist", description: "Has time but misjudges effort required" }
            };
            
            // Pattern-based determination
            if (percentages.A > 70) return types[1];
            if (percentages.A > 60 && percentages.B > 60) return types[2];
            if (percentages.B > 70 && percentages.C > 60) return types[3];
            if (percentages.C > 70) return types[4];
            if (percentages.D > 70) return types[5];
            if (percentages.E > 70) return types[6];
            if (percentages.B > 70 && percentages.A < 30) return types[7];
            
            // Fallback to total score
            if (totalScore >= 55) return types[1];
            if (totalScore >= 45) return types[2];
            if (totalScore >= 38) return types[3];
            if (totalScore >= 30) return types[4];
            if (totalScore >= 22) return types[5];
            if (totalScore >= 15) return types[6];
            return types[7];
        }
        
        function generateChallengeText(section, percentage, situationType) {
            const challenges = {
                A: `Your weekly schedule changes significantly (${Math.round(percentage)}% volatility score).`,
                B: `You consistently underestimate how long tasks take (${Math.round(percentage)}% planning gap).`,
                C: `You're unsure which study methods actually work (${Math.round(percentage)}% strategy gap).`,
                D: `Attention and energy management are your main constraints (${Math.round(percentage)}% focus challenge).`,
                E: `External constraints significantly impact your scheduling (${Math.round(percentage)}% access challenge).`
            };
            
            return `<p>Your diagnostic shows that <strong>${challenges[section]}</strong> This isn't a personal flaw‚Äîit means you're a <em>"${situationType.name}"</em> who needs a different system.</p>`;
        }
        
        function generateAhaMoment(highestSection, lowestSection, situationType) {
            const ahaMoments = {
                A: `"Your current system fails because it assumes a predictable week, but yours changes constantly. Instead of fighting this, build a flexible system that adapts week-to-week."`,
                B: `"Your planning doesn't account for reality. You're not lazy‚Äîyou're using estimates that don't match actual task duration. Add 50% buffer to all time estimates."`,
                C: `"You're putting in time but not getting results because you're using ineffective study methods. Replace rereading with retrieval practice and spaced repetition."`,
                D: `"You have time scheduled but can't focus during it. This isn't discipline‚Äîit's cognitive load. Schedule demanding tasks during peak energy hours only."`,
                E: `"Standard advice assumes stable conditions, but yours vary. Don't force a 'perfect' schedule‚Äîbuild one that works with your actual constraints."`
            };
            
            return ahaMoments[highestSection] || `"Your ${situationType.description}"`;
        }
        
        function generateMismatchDetail(highestSection, percentages) {
            const mismatches = {
                A: `The standard advice assumes predictable weeks, but your reality requires flexible, modular systems that can adapt to changing demands.`,
                B: `Conventional planning assumes accurate time estimation, but you need systems with built-in buffers and realistic task breakdowns.`,
                C: `Typical study advice assumes you know effective methods, but you need explicit training in evidence-based learning strategies.`,
                D: `Traditional scheduling assumes willpower is constant, but you need energy-aware planning that matches tasks to cognitive capacity.`,
                E: `Common systems assume equal access and conditions, but you need adaptive approaches that work within your specific constraints.`
            };
            
            return mismatches[highestSection] || "Your current system doesn't match your actual constraints.";
        }
        
        function calculateLabImpact(percentages) {
            if (percentages.A > 60) return "HIGH: Labs disrupt your entire week";
            if (percentages.D > 60) return "HIGH: Labs drain cognitive energy";
            if (percentages.B > 60) return "MODERATE: Lab prep requires better planning";
            if (percentages.C > 60) return "MODERATE: Need lab-specific study strategies";
            return "LOW: Labs fit reasonably in your schedule";
        }
        
        function generateScoreAnalysis() {
            const container = document.getElementById('scoreAnalysisContainer');
            const profile = window.userProfile;
            
            let html = '';
            
            for (const section in profile.percentages) {
                const percentage = profile.percentages[section];
                const score = profile.scores[section];
                const max = sectionMaxScores[section];
                const sectionNames = {A:'Time Volatility', B:'Planning Skills', C:'Study Strategies', D:'Attention & Focus', E:'Access & Constraints'};
                
                // Determine score level
                let level = '';
                let levelClass = '';
                let levelLabel = '';
                
                if (percentage < 34) {
                    level = 'low';
                    levelClass = 'score-low';
                    levelLabel = 'score-low-label';
                } else if (percentage < 67) {
                    level = 'medium';
                    levelClass = 'score-medium';
                    levelLabel = 'score-medium-label';
                } else {
                    level = 'high';
                    levelClass = 'score-high';
                    levelLabel = 'score-high-label';
                }
                
                // Generate insight
                const insight = generateSectionInsight(section, percentage, level);
                
                html += `
                    <div class="analysis-section">
                        <div class="section-header-score">
                            <div class="section-title">${section}. ${sectionNames[section]}</div>
                            <div class="score-display">
                                <span class="score-value">${score}/${max}</span>
                                <span class="score-label ${levelLabel}">${level.toUpperCase()}</span>
                                <div class="score-bar-container">
                                    <div class="score-bar ${levelClass}" style="width: ${percentage}%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="personalized-insight">
                            <span class="insight-icon ${level === 'low' ? 'insight-strength' : level === 'high' ? 'insight-challenge' : 'insight-neutral'}">
                                ${level === 'low' ? '‚úì' : level === 'high' ? '!' : '‚Ä¢'}
                            </span>
                            ${insight}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function generateSectionInsight(section, percentage, level) {
            const insights = {
                A: {
                    low: "Your schedule is relatively stable‚Äîyou can use fixed weekly plans effectively.",
                    medium: "Some weeks vary‚Äîbuild flexibility into your system with optional/adjustable blocks.",
                    high: "Your weeks change dramatically‚Äîyou need modular systems that rebuild each week."
                },
                B: {
                    low: "You're good at estimating time‚Äîyour plans match reality well.",
                    medium: "Sometimes underestimate tasks‚Äîadd 25% buffer to your time estimates.",
                    high: "You consistently underestimate how long tasks take‚Äîdouble your initial time estimates."
                },
                C: {
                    low: "You know effective study methods‚Äîfocus on applying them consistently.",
                    medium: "Some methods may be ineffective‚Äîaudit which techniques actually work for you.",
                    high: "You're using inefficient study methods‚Äîreplace rereading with retrieval practice and spaced repetition."
                },
                D: {
                    low: "You can maintain focus well‚Äîschedule demanding tasks appropriately.",
                    medium: "Attention varies‚Äîmatch task difficulty to your energy levels throughout the day.",
                    high: "Focus is your main constraint‚Äîschedule only 1-2 demanding tasks per day during peak energy."
                },
                E: {
                    low: "You have reliable access and conditions‚Äîstandard scheduling advice applies well.",
                    medium: "Some constraints exist‚Äîbuild backup plans for when conditions change.",
                    high: "External constraints dominate‚Äîcreate multiple plan versions for different scenarios."
                }
            };
            
            return insights[section][level];
        }
        
        function generateActionPlan() {
            const container = document.getElementById('actionPlanItems');
            const profile = window.userProfile;
            
            // Generate 3-5 specific actions based on scores
            const actions = [];
            
            // Always include lab anchoring
            actions.push({
                title: "Anchor Your Week Around Tuesday Lab",
                text: "Treat Tuesday 2:00-4:50 as the fixed point your week revolves around. Build everything else around this."
            });
            
            // Based on highest scoring section
            const highSectionActions = {
                A: {
                    title: "Implement Modular Scheduling",
                    text: "Create study blocks that can move between Tuesday/Wednesday/Thursday based on weekly changes."
                },
                B: {
                    title: "Apply the 50% Buffer Rule",
                    text: "For every study session you plan, add 50% more time than your initial estimate."
                },
                C: {
                    title: "Schedule Strategy Learning Time",
                    text: "Dedicate 30 minutes this week to learning about retrieval practice and spaced repetition."
                },
                D: {
                    title: "Protect Your Peak Energy Hours",
                    text: "Identify your 2-3 highest energy hours daily and schedule only demanding tasks then."
                },
                E: {
                    title: "Create a Plan B for Every Study Session",
                    text: "For each scheduled session, have a 15-minute alternative ready if conditions change."
                }
            };
            
            if (highSectionActions[profile.highestSection]) {
                actions.push(highSectionActions[profile.highestSection]);
            }
            
            // Based on total score
            if (profile.totalScore > 50) {
                actions.push({
                    title: "Schedule a Weekly Rebuild Session",
                    text: "Every Sunday, spend 20 minutes rebuilding your week based on that week's specific demands."
                });
            }
            
            if (profile.percentages.D > 60) {
                actions.push({
                    title: "Implement the 45-Minute Rule",
                    text: "No pre-lab study session longer than 45 minutes. Break longer tasks across multiple days."
                });
            }
            
            // Build HTML
            let html = '';
            actions.forEach((action, index) => {
                html += `
                    <div class="action-item">
                        <div class="action-number">${index + 1}</div>
                        <div class="action-content">
                            <h4>${action.title}</h4>
                            <p>${action.text}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function generateLabDesign() {
            const profile = window.userProfile;
            
            // Pre-lab design based on planning and strategy scores
            let preLabTime = "45 minutes Monday";
            let preLabStrategy = "Active reading of lab protocol, identifying key terms";
            
            if (profile.percentages.B > 60) {
                preLabTime = "30 min Sunday + 30 min Monday";
                preLabStrategy = "Distributed preparation: skim Sunday, detailed prep Monday";
            }
            
            if (profile.percentages.C > 60) {
                preLabStrategy = "Focus on understanding WHY procedures matter, not just WHAT to do";
            }
            
            // In-lab design based on attention scores
            let inLabStrategy = "Focus on data collection, annotate as you go, flag confusing steps";
            if (profile.percentages.D > 60) {
                inLabStrategy = "Focus ONLY on data collection. Mark 'review later' for anything confusing. No multitasking.";
            }
            
            // Post-lab design based on time volatility
            let postLabTime = "20 min Tuesday + 45 min Wednesday";
            let postLabStrategy = "Tuesday: organize data, Wednesday: analyze and connect to concepts";
            
            if (profile.percentages.A > 60) {
                postLabTime = "Flexible: 15-30 min within 24 hours of lab";
                postLabStrategy = "Light processing immediately, deeper analysis when schedule allows";
            }
            
            if (profile.percentages.D > 70) {
                postLabTime = "15 min Tuesday only";
                postLabStrategy = "Just organize data Tuesday. Schedule analysis for Wednesday morning when refreshed.";
            }
            
            // Update DOM
            document.getElementById('preLabTime').textContent = preLabTime;
            document.getElementById('preLabStrategy').textContent = preLabStrategy;
            document.getElementById('inLabStrategy').textContent = inLabStrategy;
            document.getElementById('postLabTime').textContent = postLabTime;
            document.getElementById('postLabStrategy').textContent = postLabStrategy;
        }
        
        function generateVisualization() {
            const profile = window.userProfile;
            const container = document.getElementById('comparisonViz');
            const sectionNames = ['Time', 'Planning', 'Strategy', 'Focus', 'Access'];
            const averageScores = [12, 7, 6, 8, 6]; // Typical student averages
            
            let html = '';
            
            Object.keys(profile.scores).forEach((section, index) => {
                const score = profile.scores[section];
                const average = averageScores[index];
                const max = sectionMaxScores[section];
                
                // Calculate heights (max 100px)
                const yourHeight = (score / max) * 100;
                const avgHeight = (average / max) * 100;
                
                // Determine color based on comparison
                const color = score > average ? '#D44500' : '#00703C';
                
                html += `
                    <div class="viz-column">
                        <div class="viz-bar" style="height: ${yourHeight}px; background-color: ${color};"></div>
                        <div class="viz-label">${sectionNames[index]}</div>
                        <div class="viz-value">You: ${score}</div>
                        <div class="viz-value" style="color: #999;">Avg: ${average}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Replace the original showResults call with enhanced version
        // In your existing event listeners:
        document.getElementById('viewResults')?.addEventListener('click', showEnhancedResults);
        
        // Add download functionality
        document.getElementById('downloadPersonalPlan')?.addEventListener('click', function() {
            alert('Personal Plan PDF would include:\n1. Your personalized insights\n2. Action plan\n3. Lab-centered schedule\n4. Score analysis\n\nImplementation would use jsPDF library.');
        });
        
        document.getElementById('scheduleAdvisorMeeting')?.addEventListener('click', function() {
            alert('This would integrate with your campus advising scheduling system.');
        });
        
        document.getElementById('retakeDiagnosticBtn')?.addEventListener('click', function() {
            if (confirm('Retake diagnostic? Your current results will be cleared.')) {
                localStorage.removeItem('uwpScheduleDiagnostic');
                location.reload();
            }
        });
    </script>
</body>
</html>
